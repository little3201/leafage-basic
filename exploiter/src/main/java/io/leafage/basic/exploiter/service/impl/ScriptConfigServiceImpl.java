package io.leafage.basic.exploiter.service.impl;

import io.leafage.basic.exploiter.domain.ScriptConfig;
import io.leafage.basic.exploiter.repository.ScriptConfigRepository;
import io.leafage.basic.exploiter.service.ScriptConfigService;
import io.leafage.basic.exploiter.vo.ScriptConfigVO;
import org.springframework.cglib.beans.BeanCopier;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class ScriptConfigServiceImpl implements ScriptConfigService {

    private final ScriptConfigRepository scriptConfigRepository;

    public ScriptConfigServiceImpl(ScriptConfigRepository scriptConfigRepository) {
        this.scriptConfigRepository = scriptConfigRepository;
    }

    @Override
    public List<ScriptConfigVO> retrieve(String name) {
        return scriptConfigRepository.findAll().stream().map(this::convert).toList();
    }


    /**
     * 类型转换
     *
     * @param scriptConfig 信息
     * @return DictionaryVO 输出对象
     */
    private ScriptConfigVO convert(ScriptConfig scriptConfig) {
        ScriptConfigVO vo = new ScriptConfigVO();
        BeanCopier copier = BeanCopier.create(ScriptConfig.class, ScriptConfigVO.class, false);
        copier.copy(scriptConfig, vo, null);
        vo.setLastModifiedDate(scriptConfig.getLastModifiedDate().orElse(null));
        return vo;
    }
}
